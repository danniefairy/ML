Some of the code are study from Morvan, and I figure out the logic and add some detail.